- provide :title, @event.name
- can_manage = policy(@event).update?

.container.top-buffer#event

  .content-block
    .row
      #event-header.col-md-8.col-md-offset-2.text-center
        = render 'header'

      .col-md-2
        - if can_manage
          .pull-right
            = link_to(edit_event_path(@event),
              remote: true,
              'data-params': { 'display_raw_results' => @display_raw_results }.to_param,
              class: 'btn btn-default edit-event') do
              %i.fa.fa-fw.fa-pencil.text-muted
              = t('general.edit')

    .row{class: ('top-buffer' if can_manage)}
      .col-md-7.col-sm-7
        - if can_manage && !@event.finished?
          = new_section_link(@event, @display_raw_results)
          = new_competitor_link(@event, @display_raw_results)

          - if @event.hungary_boogie?
            = button_to event_rounds_path(@event),
                        method: :post,
                        remote: true,
                        params: {'round[discipline]' => :distance, 'display_raw_results' => @display_raw_results},
                        class: 'btn btn-default' do
              %i.fa.fa-plus
              = t('activerecord.models.round')

          -else
            .btn-group
              %button.btn.btn-default{'data-toggle' => 'dropdown'}
                %i.fa.fa-plus
                = t('activerecord.models.round')
                %i.fa.fa-caret-down
              %ul.dropdown-menu.dropdown-menu-right{role: 'menu'}
                %li= add_round_button(@event, :distance, @display_raw_results)
                %li= add_round_button(@event, :speed, @display_raw_results)
                %li= add_round_button(@event, :time, @display_raw_results)

      .col-md-5.col-sm-5
        .pull-right
          %button{class: ['btn', 'btn-default', ('active' if @event.active? && !can_manage)],
                  'data-controller': 'events--autoupdate',
                  'data-action': 'click->events--autoupdate#trigger_state',
                  'data-event-id': @event.id}
            = link_to '', url_for(show_params.merge(autoupdate: true)),
                      class: 'hide',
                      remote: true,
                      'data-target': 'events--autoupdate.link',
                      'data-action': 'ajax:before->events--autoupdate#update_start ajax:complete->events--autoupdate#update_finish'

            %i.fa.fa-refresh.text-muted{'data-target': 'events--autoupdate.indicator'}
            Autoupdate

          - if @event.wind_cancellation
            = link_to t('events.show.weather_data'),
                      event_weather_data_path(@event),
                      remote: true,
                      class: 'btn btn-default'
          - if can_manage
            .btn-group.event-status-group
              %button.btn.btn-default.event-status-button{'data-toggle' => 'dropdown'}
                = t('activerecord.attributes.event.status') + ': ' + t('event_status.' + @event.status)
                %i.fa.fa-caret-down
              %ul.dropdown-menu.dropdown-menu-right{role: 'menu'}
                %li{class: ('active' if @event.draft?)}
                  = button_to t('event_status.draft'),
                                event_path(@event),
                                method: :patch,
                                remote: true,
                                params: {'event[status]' => 'draft'},
                                class: 'btn-link event-set-status-draft'

                %li{class: ('active' if @event.published?)}
                  = button_to t('event_status.published'),
                                event_path(@event),
                                method: :patch,
                                remote: true,
                                params: {'event[status]' => :published},
                                class: 'btn-link event-set-status-published'

                %li{class: ('active' if @event.finished?)}
                  = button_to t('event_status.finished'),
                                event_path(@event),
                                method: :patch,
                                remote: true,
                                params: {'event[status]' => 'finished'},
                                class: 'btn-link event-set-status-finished'

    .row.top-buffer
      .col-md-12
        = render @scoreboard.template, can_manage: can_manage

    - if @event.wind_cancellation
      .row
        .col-md-12#event-wind-cancellation-caption
          %span
            = t('events.show.wind_cancellation_enabled')
          %span
            = t('events.show.results_showing')
            - if (@display_raw_results)
              = link_to t('events.show.results_adjusted_caption'),
                        show_params.merge(display_raw_results: false),
                        remote: true
              \/
              %b= t('events.show.results_not_adjusted_caption')
            - else
              %b= t('events.show.results_adjusted_caption')
              \/
              = link_to t('events.show.results_not_adjusted_caption'),
                        show_params.merge(display_raw_results: true),
                        remote: true

    .row
      .col-md-12
        = render 'organizers/list',
                 organizable: @event,
                 editable: (can_manage && !@event.finished?)

    .row.top-buffer
      = render 'sponsors/list',
               sponsorable: @event,
               editable: (can_manage && !@event.finished?)

- content_for :page_js do
  %script
    = render partial: 'show_controls', formats: [:js]
